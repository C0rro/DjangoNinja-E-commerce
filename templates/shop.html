{% extends "base.html" %}
{% block title %}Catalogo Peperoncini{% endblock %}

{% block content %}

<h1 class="text-3xl font-bold mb-6">üå∂Ô∏è Il Nostro Shop</h1>

<div class="flex justify-end">
    <div class="">
    <div class="dropdown">
        <div tabindex="0" role="button" class="btn m-1 btn-primary text-white">Filtra per famiglia</div>
            <ul tabindex="-1" class="dropdown-content menu bg-white rounded-box  w-52 p-2 shadow-sm z-50">
                <li><a>Item 1</a></li>
                <li><a>Item 2</a></li>
            </ul>
    </div>
</div>
<div class="">
    <div class="dropdown">
        <div tabindex="0" role="button" class="btn m-1 btn-primary text-white">Ordina</div>
            <ul tabindex="-1" class="dropdown-content menu bg-white rounded-box  w-52 p-2 shadow-sm z-50">
                <li><a>Item 1</a></li>
                <li><a>Item 2</a></li>
            </ul>
    </div>
</div>
</div>


<div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4 ">
    </div>

<script>

function createProductCard(product) {
    const grid = document.getElementById("product-grid");

    // 1. Elemento Link (<a>)
    const cardLink = document.createElement("a");
    cardLink.href = `/shop/${product.id}/`;
    cardLink.className = "card bg-base-100 shadow-xl transition duration-300 ease-in-out hover:shadow-2xl hover:scale-[1.02]";

    // 2. Contenuto della Card (<div>)
    const cardBody = document.createElement("div");
    cardBody.className = "card-body items-center text-center p-6";

    // 3. Titolo (<h2>)
    const title = document.createElement("h2");
    title.className = "card-title text-2xl font-semibold";
    title.textContent = product.peperoncino.name;

    // 4. Immagine (<img>)
    const image = document.createElement("img");
    image.src = product.peperoncino.image;
    image.alt = `Immagine del peperoncino ${product.peperoncino.name}`;
    image.className = "rounded-lg w-full h-40 object-cover my-4";
    image.style.maxHeight = "10rem"; // Assicura che l'immagine sia contenuta

    // 5. Livello Scoville (<p>)
    const scoville = document.createElement("p");
    scoville.className = "text-sm text-warning font-bold";
    scoville.textContent = `Scoville: ${product.peperoncino.scoville.toLocaleString('it-IT')}`;

    // 6. Prezzo (<p>)
    const price = document.createElement("p");
    price.className = "text-lg font-bold text-primary mt-2";
    price.textContent = `Prezzo: ${product.price} ‚Ç¨`;

    // Assemblaggio
    cardBody.appendChild(title);
    cardBody.appendChild(scoville);
    cardBody.appendChild(image);
    cardBody.appendChild(price);

    cardLink.appendChild(cardBody);

    grid.appendChild(cardLink);
}

// Funzione principale per il recupero dei dati
fetch("/app/products/")
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        // Itera sui dati e crea una card per ogni prodotto
        data.forEach(createProductCard);
    })
    .catch(error => {
        console.error("Errore nel caricamento dei prodotti:", error);
        // Opzionale: Mostra un messaggio di errore all'utente
        document.getElementById("product-grid").innerHTML =
            '<p class="text-error col-span-full">Non √® stato possibile caricare i prodotti. Riprova pi√π tardi.</p>';
    });

</script>

{% endblock %}